{"version":3,"file":"commonHelpers5.js","sources":["../src/js/manage-listeners.js","../src/js/real-time-sw.js"],"sourcesContent":["import {\n  getData,\n  setData,\n  getStepsList,\n  addStepToList,\n  getCurrentLine,\n  resetStepList,\n} from './firebase-api';\nimport * as Utilites from './utilites';\nimport { refs } from './refs';\nimport { nanoid } from 'nanoid';\n\nexport async function setReady() {\n  const data = await getData();\n  if (data.isReady < 2) {\n    const newReadyID = data.isReady + 1;\n    localStorage.setItem('readyID', newReadyID);\n    Utilites.disableBtn(refs.readyBtn);\n    setData({\n      ...data,\n      isReady: newReadyID,\n    });\n  }\n}\n\nexport async function onStart() {\n  const data = await getData();\n  const startDate = Date.now();\n  setData({\n    ...data,\n    isStart: true,\n    start: startDate,\n  });\n}\n\nexport async function onStop() {\n  const user = JSON.parse(localStorage.getItem('log')).user;\n  const data = await getData();\n  const stepsList = await getStepsList();\n  const currentLine = await getCurrentLine();\n\n  const stopDate = Date.now();\n  const stepNum = stepsList.items.length > 0 ? stepsList.items.length + 1 : 1;\n  const seconds = stopDate - data.start;\n\n  const newStepItem = {\n    id: nanoid(),\n    user: user,\n    task: currentLine,\n    step: stepNum,\n    time: seconds,\n  };\n\n  addStepToList(newStepItem);\n\n  setData({\n    ...data,\n    isReady: 0,\n    isStart: false,\n    stop: stopDate,\n  });\n}\n\nexport function onReset() {\n  refs.resetBackdrop.classList.remove('visually-hidden');\n  document.querySelector('body').style.overflow = 'hidden';\n  refs.resetBackdrop.addEventListener('click', onClose);\n  refs.listBtns.classList.add('button-hidden');\n  document.addEventListener('keydown', onCloseByEsc);\n}\n\nfunction onClose(e) {\n  if (\n    e.target.classList.contains('reset-backdrop') ||\n    e.target.classList.contains('no-btn')\n  ) {\n    document.querySelector('body').style.overflow = 'auto';\n    refs.resetBackdrop.classList.add('visually-hidden');\n    refs.listBtns.classList.remove('button-hidden');\n  }\n  if (e.target.classList.contains('yes-btn')) {\n    document.querySelector('body').style.overflow = 'auto';\n    refs.resetBackdrop.classList.add('visually-hidden');\n    resetStepList();\n  }\n}\n\nfunction onCloseByEsc(e) {\n  if (e.keyCode === 27) {\n    document.querySelector('body').style.overflow = 'auto';\n    refs.resetBackdrop.classList.add('visually-hidden');\n    refs.listBtns.classList.remove('button-hidden');\n  }\n}\n","import * as FirebaseApi from './firebase-api';\nimport * as ManageListeners from './manage-listeners';\nimport { refs } from './refs';\nimport { checkLogin, onBack, logOut } from './utilites';\n\ncheckLogin();\n\nrefs.readyBtn.addEventListener('click', ManageListeners.setReady);\nrefs.startBtn.addEventListener('click', ManageListeners.onStart);\nrefs.stopBtn.addEventListener('click', ManageListeners.onStop);\nrefs.resetBtn.addEventListener('click', ManageListeners.onReset);\nrefs.backBtn.addEventListener('click', onBack);\nrefs.logOutBtn.addEventListener('click', logOut);\nrefs.stepsList.addEventListener('click', onDelete);\nrefs.sendBtn.addEventListener('click', onSend);\ndocument.addEventListener('scroll', showBtnsList);\n\nFirebaseApi.checkData();\nFirebaseApi.checkList();\nFirebaseApi.checkCurrentLine();\n\nconst listPosition = refs.stepsList.getBoundingClientRect().top;\nconst windowInnerHeight = window.innerHeight;\n\nrefs.navName.innerHTML = JSON.parse(localStorage.getItem('log')).user;\n\nrefs.taskForm.addEventListener('submit', onSaveLine);\n\nfunction onSaveLine(e) {\n  e.preventDefault();\n  FirebaseApi.setCurrentLine(refs.taskInput.value);\n}\n\nfunction showBtnsList() {\n  const windowScrollHeight = window.scrollY;\n\n  if (refs.listBtns && windowScrollHeight >= listPosition - windowInnerHeight) {\n    refs.listBtns.classList.remove('button-hidden');\n  } else {\n    refs.listBtns.classList.add('button-hidden');\n  }\n}\n\nasync function onDelete(e) {\n  if (e.target.nodeName !== 'BUTTON') {\n    return;\n  }\n\n  FirebaseApi.deleteStepById(e.target.id);\n}\n\nasync function onSend() {\n  refs.sendBackdrop.classList.remove('visually-hidden');\n  const data = await FirebaseApi.getStepsList();\n  data.type = 'realtime-stop-watch';\n\n  refs.listBtns.classList.add('button-hidden');\n\n  try {\n    const res = await fetch(\n      'https://script.google.com/macros/s/AKfycbwQfPNpDsZK7s3qT5Jt8PBS7B2YnK_ILFqPV65fPhuc7J9jd8vJYz4g8oSnoR0GqPSE/exec',\n      {\n        method: 'POST',\n        body: JSON.stringify(data),\n      }\n    );\n  } catch (error) {\n    onErrorToast('Oops. Something went wrong.', '#');\n  } finally {\n    refs.listBtns.classList.remove('button-hidden');\n    refs.sendBackdrop.classList.add('visually-hidden');\n  }\n}\n"],"names":["setReady","data","getData","newReadyID","Utilites.disableBtn","refs","setData","onStart","startDate","onStop","user","stepsList","getStepsList","currentLine","getCurrentLine","stopDate","stepNum","seconds","newStepItem","nanoid","addStepToList","onReset","onClose","onCloseByEsc","resetStepList","checkLogin","ManageListeners.setReady","ManageListeners.onStart","ManageListeners.onStop","ManageListeners.onReset","onBack","logOut","onDelete","onSend","showBtnsList","FirebaseApi.checkData","FirebaseApi.checkList","FirebaseApi.checkCurrentLine","listPosition","windowInnerHeight","onSaveLine","FirebaseApi.setCurrentLine","windowScrollHeight","FirebaseApi.deleteStepById","FirebaseApi.getStepsList","res"],"mappings":"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"}