{"version":3,"file":"commonHelpers.js","sources":["../src/js/default-sw.js"],"sourcesContent":["import * as FirebaseApi from './firebase-api';\nimport { refs } from './refs';\nimport { nanoid } from 'nanoid';\nimport { checkLogin, getName, getTask, logOut, onBack } from './utilites';\nimport editIcon from '../img/edit.svg';\nimport { onErrorToast } from './utilites';\n\ncheckLogin();\ncheckTask();\n\nFirebaseApi.checkIsBusy('default_stopwatch_1');\nFirebaseApi.checkUser('default_stopwatch_1');\n\nconst listPosition = refs.stepsList.getBoundingClientRect().top;\nconst windowInnerHeight = window.innerHeight;\n\nsetInterval(() => {\n  const user = JSON.parse(localStorage.getItem('log')).user;\n\n  FirebaseApi.setIsBusy('default_stopwatch_1', {\n    lastTime: Date.now(),\n    user: user,\n    isBusy: true,\n  });\n}, 5000);\n\nFirebaseApi.checkIsBusy('default_stopwatch_1');\n\nrefs.backBtn.addEventListener('click', onBack);\nrefs.logOutBtn.addEventListener('click', logOut);\nrefs.startBtn.addEventListener('click', onStart);\nrefs.stopBtn.addEventListener('click', onStop);\nrefs.stepsList.addEventListener('click', onDelete);\nrefs.sendBtn.addEventListener('click', onSend);\nrefs.resetBtn.addEventListener('click', onReset);\nrefs.resetBackdrop.addEventListener('click', onDecideReset);\ndocument.addEventListener('scroll', showBtnsList);\nrefs.taskInput.addEventListener('input', () => {\n  refs.taskInput.classList.remove('task-input-required');\n});\nrefs.taskForm.addEventListener('submit', onSaveTask);\n\nrefs.navName.innerHTML = JSON.parse(localStorage.getItem('log')).user;\n\nFirebaseApi.checkDefaultData();\nFirebaseApi.checkDefaultList();\n\nasync function onStart() {\n  if (!localStorage.getItem('task')) {\n    refs.taskInput.classList.add('task-input-required');\n    onErrorToast('Please, enter the task', '#task');\n    return;\n  }\n\n  const startDate = Date.now();\n\n  const data = await FirebaseApi.getDefaultData();\n  refs.taskInput.classList.remove('task-input-required');\n\n  FirebaseApi.setDefaultData({\n    ...data,\n    isStart: true,\n    start: startDate,\n  });\n}\n\nasync function onStop() {\n  const stopDate = Date.now();\n\n  const data = await FirebaseApi.getDefaultData();\n  const stepsList = await FirebaseApi.getDefaultStepsList();\n\n  const stepNum = stepsList.items.length > 0 ? stepsList.items.length + 1 : 1;\n  const time = stopDate - data.start;\n  const task = localStorage.getItem('task');\n  const user = JSON.parse(localStorage.getItem('log')).user;\n\n  const newStepItem = {\n    id: nanoid(),\n    step: stepNum,\n    time: time,\n    user: user,\n    task: task,\n  };\n\n  FirebaseApi.addDefaultStepToList(newStepItem);\n\n  FirebaseApi.setDefaultData({\n    ...data,\n    isStart: false,\n    stop: stopDate,\n  });\n}\n\nfunction showBtnsList() {\n  const windowScrollHeight = window.scrollY;\n\n  if (refs.listBtns && windowScrollHeight >= listPosition - windowInnerHeight) {\n    refs.listBtns.classList.remove('button-hidden');\n  } else {\n    refs.listBtns.classList.add('button-hidden');\n  }\n}\n\nasync function onDelete(e) {\n  if (e.target.nodeName !== 'BUTTON') {\n    return;\n  }\n\n  FirebaseApi.deleteDefaultStepById(e.target.id);\n}\n\nfunction onReset() {\n  refs.resetBackdrop.classList.remove('visually-hidden');\n  document.querySelector('body').style.overflow = 'hidden';\n  document.addEventListener('keydown', closeModalByEsc);\n}\n\nfunction onDecideReset(e) {\n  if (\n    e.target.classList.contains('no-btn') ||\n    e.target.classList.contains('backdrop')\n  ) {\n    refs.resetBackdrop.classList.add('visually-hidden');\n  } else if (e.target.classList.contains('yes-btn')) {\n    FirebaseApi.resetDefaultStepList();\n    refs.resetBackdrop.classList.add('visually-hidden');\n  }\n  document.querySelector('body').style.overflow = 'visible';\n  document.removeEventListener('keydown', closeModalByEsc);\n  return;\n}\n\nfunction closeModalByEsc(e) {\n  if (e.code !== 'Escape') return;\n  refs.resetBackdrop.classList.add('visually-hidden');\n  document.querySelector('body').style.overflow = 'visible';\n  document.removeEventListener('keydown', closeModalByEsc);\n}\n\nfunction onSaveTask(e) {\n  e.preventDefault();\n\n  if (!refs.taskInput.value) {\n    refs.taskInput.classList.add('task-input-required');\n    onErrorToast('Please, enter the task', '#task');\n    return;\n  }\n\n  localStorage.setItem('task', refs.taskInput.value);\n  checkTask();\n}\n\nfunction checkTask() {\n  if (!localStorage.getItem('task')) {\n    refs.username.innerHTML = `Hi ${getName()},`;\n    return;\n  }\n\n  refs.taskWrap.insertAdjacentHTML(\n    'afterbegin',\n    `<button type=\"button\" class=\"edit-btn\"><img class=\"edit-icon\" src=\"${editIcon}\"/></button>`\n  );\n  refs.taskForm.classList.add('task-form-hidden');\n  refs.username.innerHTML = `Great ${getName()}!`;\n  refs.taskFormDescription.innerHTML = `The task you'll be timing is \"${getTask()}\".`;\n  document.querySelector('.edit-btn').addEventListener('click', onEdit);\n}\n\nfunction onEdit() {\n  localStorage.removeItem('task');\n  document.querySelector('.edit-btn').remove();\n  refs.taskForm.classList.remove('task-form-hidden');\n  refs.username.innerHTML = `Hi ${getName()},`;\n  refs.taskFormDescription.innerHTML = `Before you begin, please enter the name of the task in the box below and click on the \"Save\" button.`;\n}\n\nasync function onSend() {\n  refs.sendBackdrop.classList.remove('visually-hidden');\n  const data = await FirebaseApi.getDefaultStepsList();\n  data.type = 'default-stop-watch';\n\n  refs.listBtns.classList.add('button-hidden');\n\n  try {\n    const res = await fetch(\n      'https://script.google.com/macros/s/AKfycbwQfPNpDsZK7s3qT5Jt8PBS7B2YnK_ILFqPV65fPhuc7J9jd8vJYz4g8oSnoR0GqPSE/exec',\n      {\n        method: 'POST',\n        body: JSON.stringify(data),\n      }\n    );\n  } catch {\n    onErrorToast('Oops. Something went wrong.', '#');\n  } finally {\n    refs.listBtns.classList.remove('button-hidden');\n    refs.sendBackdrop.classList.add('visually-hidden');\n  }\n}\n"],"names":["checkLogin","checkTask","FirebaseApi.checkIsBusy","FirebaseApi.checkUser","listPosition","refs","windowInnerHeight","user","FirebaseApi.setIsBusy","onBack","logOut","onStart","onStop","onDelete","onSend","onReset","onDecideReset","showBtnsList","onSaveTask","FirebaseApi.checkDefaultData","FirebaseApi.checkDefaultList","onErrorToast","startDate","data","FirebaseApi.getDefaultData","FirebaseApi.setDefaultData","stopDate","stepsList","FirebaseApi.getDefaultStepsList","stepNum","time","task","newStepItem","nanoid","FirebaseApi.addDefaultStepToList","windowScrollHeight","FirebaseApi.deleteDefaultStepById","closeModalByEsc","FirebaseApi.resetDefaultStepList","getName","editIcon","getTask","onEdit","res"],"mappings":"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"}